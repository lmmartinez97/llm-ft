# User Guide: highD Extractor CLI

This guide provides instructions on how to use the highD extractor through the command-line interface (CLI). The extractor processes vehicle trajectory data from the highD dataset and outputs structured JSON files, along with optional plotting or animations of the results.

## Running the CLI

To run the highD extractor through the CLI, execute the script with:

```bash
conda activate prompt_factory
python src/group_extractor/highd_cli_processor.py
```

The program will guide you through the steps interactively. You will be asked to provide several parameters and options for processing data.

### Step-by-Step Usage

1. **Dataset Directory**:
    - The program will first ask you to provide the path to the dataset directory:

    ```
    Enter the path to the dataset directory:
    ```

    - This should be the folder containing the highD dataset files (e.g., `.csv` files for trajectories and metadata).

2. **Sampling Period**:
    - The sampling period defines the time interval between frames that the extractor should process. You’ll be prompted for the sampling period in milliseconds:

    ```
    Enter the sampling period (in milliseconds):
    ```

    - **Example**: A sampling period of `100` means that every 100 ms, a frame is sampled.

3. **Lookback Window**:
    - The lookback window defines the duration (in seconds) of each segment of data to consider. This window will be used to split the dataset into time windows for analysis:

    ```
    Enter the lookback window (in seconds):
    ```

    - **Example**: A lookback window of `5` seconds means the extractor will divide the data into 5-second segments.

4. **Processing the Dataset**:
    - The program will ask whether you want to process the entire dataset or a specific file:

    ```
    Do you want to process the entire dataset or a single file? (Enter 'all' or 'one'):
    ```

    - **`all`**: Processes all available files in the dataset directory (by default, assumes 60 files).
    - **`one`**: Prompts you to specify the index of a specific file (between 1 and 60).

5. **Save Location**:
    - You will be asked to provide a directory where the results (JSON files) should be saved:

    ```
    Enter the directory to save the JSON files:
    ```

6. **Plots or Animations**:
    - After processing, the program will ask whether you want to generate plots or animations for a randomly selected group:

    ```
    Do you want to generate plots or animations? (yes/no):
    ```

    - If you choose "yes," you will then be prompted to choose between plotting or animating:

    ```
    Do you want to plot the groups or animate them? (Enter 'plot' or 'animate'):
    ```

    - The extractor will randomly select a group for visualization.

7. **Repeat or Exit**:
    - After processing, the program will ask if you want to process more data:

    ```
    Do you want to process more data? (yes/no):
    ```

    - If you choose "yes," the program will start again from step 1. If you choose "no," the program will exit.

### Parameters of the Extractor

The `HighDGroupExtractor` class used by the CLI processes the dataset with the following parameters:

- **dataset_location**: The path to the directory containing the dataset files (required).
- **dataset_index**: The index of the dataset file to process (between 1 and 60).
- **sampling_period**: The time spacing between frames to be processed (in milliseconds). The sampling period must be a multiple of 40 ms (the frame duration of the highD dataset).
- **lookback_window**: The size of the time window (in seconds) used to group frames for analysis.
- **frame_length**: The duration of each frame in the dataset (fixed at 40 ms).
- **window_size**: The number of frames in each window, derived from the lookback window.
- **groups**: The output list of vehicle groups generated by the extractor. Each group is a collection of vehicles within a specified "bubble" radius around an ego vehicle.

### Example Run

Here’s an example run where you process a single file with a sampling period of 100 ms and a 5-second lookback window:

```bash
$ python highd_cli_processor.py
```

```
Enter the path to the dataset directory: /path/to/highd-dataset
Enter the sampling period (in milliseconds): 100
Enter the lookback window (in seconds): 5
Do you want to process the entire dataset or a single file? (Enter 'all' or 'one'): one
Enter the dataset index (between 1 and 60): 3
Enter the directory to save the JSON file: /path/to/save
Do you want to generate plots or animations? (yes/no): yes
Do you want to plot the groups or animate them? (Enter 'plot' or 'animate'): plot
Plotting group 7...
Do you want to process more data? (yes/no): no
Exiting the program.
```
